<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ifms.adm.bbs.faq.mapper.AdmFaqMapper">

	<!-- FAQ 목록 조회 -->
	<select id="selectFaqList" resultType="egovMap" parameterType="map">
		SELECT ROW_NUMBER() OVER (ORDER BY FAQ_SN) AS ROW_NUM
			, FAQ_SN
			, QSTN_TTL
			, BBS_CLSF_CD
			, CASE WHEN (BBS_CLSF_CD IS NOT NULL AND BBS_CLSF_CD != '') THEN BBS_CLSF_CD
				ELSE '기타'
				END AS CATE_NM
			, ANS_CN
			, INQ_CNT
			, FILE_GROUP_SN
			, FAQ_SEQ
			, FRST_REG_DT
			, LAST_MDFCN_DT
		FROM SZMS.PT_FAQ_M
		WHERE 1 = 1
			<if test="searchCategory != null and searchCategory != ''">
				AND BBS_CLSF_CD = #{searchCategory}
			</if>
			<if test="searchCondition == 'TTL'">  
  		  		AND QSTN_TTL LIKE '%' || #{searchKeyword} || '%' 
  		  	</if>
  		  	<if test="searchCondition == 'CN'">  
  		  		AND ANS_CN LIKE '%' || #{searchKeyword} || '%' 
  		  	</if>
  		  	<if test="searchCondition == ''">  
  		  		AND ((QSTN_TTL LIKE '%' || #{searchKeyword} || '%')
  		  			OR 
  		  			(ANS_CN LIKE '%' || #{searchKeyword} || '%'))
  		  	</if>
  		ORDER BY FAQ_SEQ, FAQ_SN DESC
  		OFFSET #{startNo} ROWS FETCH NEXT #{listCount} ROWS ONLY
	</select>
	
	<!-- FAQ 총건수 -->
	<select id="selectFaqListTotalCnt" resultType="int" parameterType="map">
		 SELECT COUNT(*)
		 FROM SZMS.PT_FAQ_M
		 WHERE 1 = 1
			<if test="searchCategory != null and searchCategory != ''">
				AND BBS_CLSF_CD = #{searchCategory}
			</if>
			<if test="searchCondition == 'TTL'">  
  		  		AND QSTN_TTL LIKE '%' || #{searchKeyword} || '%' 
  		  	</if>
  		  	<if test="searchCondition == 'CN'">  
  		  		AND ANS_CN LIKE '%' || #{searchKeyword} || '%' 
  		  	</if>
  		  	<if test="searchCondition == ''">  
  		  		AND ((QSTN_TTL LIKE '%' || #{searchKeyword} || '%')
  		  			OR 
  		  			(ANS_CN LIKE '%' || #{searchKeyword} || '%'))
  		  	</if>
	</select>
	
	<!-- 카테고리 조회 -->
	<select id="selectFaqCategory" resultType="egovMap">
		SELECT DISTINCT BBS_CLSF_CD
		FROM SZMS.PT_FAQ_M
		WHERE BBS_CLSF_CD IS NOT NULL
	</select>
	
	<!-- FAQ 등록 -->
	<insert id="insertFaq" parameterType="map">
		INSERT INTO SZMS.PT_FAQ_M(
			FAQ_SN
			, QSTN_TTL
			, ANS_CN
			, INQ_CNT
			, BBS_CLSF_CD
			, FRST_REG_DT
			, FRST_RGTR_ID
		) 
		VALUES(
			NEXTVAL('SZMS.SQ_PT_FAQ_M')
			, #{qstnTtl}
			, #{ansCn}
			, 1
			, #{bbsClsfCd}
			, CURRENT_TIMESTAMP
			, #{frstRgtrId}
		)
	</insert>
	
	<!-- FAQ 삭제 -->
	<delete id="deleteFaq" parameterType="map">
		DELETE FROM SZMS.PT_FAQ_M
		WHERE FAQ_SN = CAST(#{faqSn} AS NUMERIC)
	</delete>
	
	<!-- FAQ 상세조회 -->
	<select id="selectFaqDetail" parameterType="map" resultType="egovMap">
		SELECT FAQ_SN
			, QSTN_TTL
			, BBS_CLSF_CD
			, ANS_CN
			, FAQ_SEQ
			, FRST_REG_DT
			, LAST_MDFCN_DT
		FROM SZMS.PT_FAQ_M
		WHERE FAQ_SN = CAST(#{faqSn} AS NUMERIC)
	</select>
	
	<!-- FAQ 수정 -->
	<update id="updateFaq" parameterType="map">
		UPDATE SZMS.PT_FAQ_M
		SET QSTN_TTL = #{qstnTtl}
			, BBS_CLSF_CD = #{bbsClsfCd}
			, ANS_CN = #{ansCn}
		WHERE FAQ_SN = CAST(#{faqSn} AS NUMERIC)
	</update>
</mapper>