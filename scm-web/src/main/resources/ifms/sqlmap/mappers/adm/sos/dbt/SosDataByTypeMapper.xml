<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ifms.adm.sos.dbt.mapper.SosDataByTypeMapper">

	<!-- 목록 총건수 -->
	<select id="selectDbtListTotalCount" parameterType="map" resultType="int">
		SELECT COUNT(*)
		FROM PG_STAT_USER_TABLES P
		LEFT JOIN PG_CATALOG.PG_CLASS C ON P.RELNAME = C.RELNAME 
		WHERE 1 = 1
			AND P.SCHEMANAME IN ('szms', 'gis', 'cad')
			<if test="srchCondition == 'tableNm'">
				AND P.RELNAME LIKE '%' || #{srchKeyword} || '%'
			</if>		
			<if test="srchCondition == 'tableLogicalNm'">
				AND OBJ_DESCRIPTION(C.OID) LIKE '%' || #{srchKeyword} || '%'
			</if>		
			<if test="srchCondition == ''">
				AND (OBJ_DESCRIPTION(C.OID) LIKE '%' || #{srchKeyword} || '%')
					or (P.RELNAME like '%' || #{srchKeyword} || '%')
			</if>		
	</select>	

	<!-- 목록 조회 -->
	<select id="selectDbtList" parameterType="map" resultType="egovMap">
		SELECT ROW_NUMBER() OVER (ORDER BY P.RELNAME) AS ROW_NUM
			, P.SCHEMANAME AS SCHEMA_NAME
			, P.RELNAME AS TABLE_NAME
			, OBJ_DESCRIPTION(C.OID) AS TABLE_LOGICAL_NAME
			, TO_CHAR(P.N_LIVE_TUP, 'FM999,999,999,999,999') AS DATA_COUNT
		FROM PG_STAT_USER_TABLES P
		LEFT JOIN PG_CATALOG.PG_CLASS C ON P.RELNAME = C.RELNAME 
		WHERE P.SCHEMANAME IN ('szms', 'gis', 'cad')
			<if test="srchCondition == 'tableNm'">
				AND P.RELNAME LIKE '%' || #{srchKeyword} || '%'
			</if>		
			<if test="srchCondition == 'tableLogicalNm'">
				AND OBJ_DESCRIPTION(C.OID) LIKE '%' || #{srchKeyword} || '%'
			</if>		
			<if test="srchCondition == ''">
				AND (OBJ_DESCRIPTION(C.OID) LIKE '%' || #{srchKeyword} || '%')
					or (P.RELNAME like '%' || #{srchKeyword} || '%')
			</if>	
		ORDER BY P.RELNAME
		OFFSET #{startNo} ROWS FETCH NEXT #{listCount} ROWS ONLY
	</select>
</mapper>